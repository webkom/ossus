{% extends "machine/base.html" %}
{% load i18n %}

{% block main %}

    <section id="responsive">

    <div class="page-header">
        <h3>{{ machine.name }}</h3>
    </div>

    <div class="row">
    <div class="span6">
        <table class="table table-bordered table-striped">
            <tbody>
            <tr>
                <td>{% trans "ID" %}</td>
                <td>{{ machine.id }}</td>
            </tr>
            <tr>
                <td>Name</td>
                <td>{{ machine.name }}</td>
            </tr>
            <tr>
                <td>Customer</td>
                <td>{{ machine.customer.name }}</td>
            </tr>
            <tr>
                <td>Last connection to client</td>
                <td>{{ machine.last_connection_to_client }}</td>
            </tr>
            <tr>
                <td>External IP</td>
                <td>{{ machine.external_ip }}</td>
            </tr>
            <tr>
                <td>Auto version</td>
                <td>{{ machine.auto_version }}</td>
            </tr>
            <tr>
                <td>Current agent version</td>
                <td>{{ machine.current_agent_version }}</td>
            </tr>
            <tr>
                <td>Auto updater version</td>
                <td>{{ machine.current_updater_version }}</td>
            </tr>
            </tbody>
        </table>

    </div>
    <div class="span6">

        <script type="text/javascript">

            var chart;
            $(document).ready(function () {
                chart = new Highcharts.Chart({
                    chart:{
                        renderTo:'container_load',
                        defaultSeriesType:'area'
                    },
                    title:{
                        text:'Load'
                    },
                    xAxis:{
                        categories:[{% for stat in machine.get_latest_stats %}
                            '{{ stat.datetime|date:"H:i" }}',
                        {% endfor %}],
                        tickmarkPlacement:'on',
                        title:{
                            enabled:false
                        }
                    },
                    tooltip:{
                        formatter:function () {
                            return '' +
                                    this.x + ': ' + Highcharts.numberFormat(this.y, 0, ',') + ' millions';
                        }
                    },

                    plotOptions:{
                        area:{
                            stacking:'normal',

                            lineColor:'#666666',
                            lineWidth:1,
                            marker:{
                                lineWidth:1,
                                lineColor:'#666666'
                            }
                        }
                    },
                    series:[
                        {
                            name:'User',
                            data:[{% for stat in machine.get_latest_stats %}
                                {{ stat.load_average }},
                            {% endfor %}
                            ]
                        }
                    ]
                });
            });

        </script>

        <script type="text/javascript">

            var chart;
            $(document).ready(function () {
                chart = new Highcharts.Chart({
                    chart:{
                        renderTo:'container_cpu',
                        defaultSeriesType:'area'
                    },
                    title:{
                        text:'Prosessor'
                    },
                    xAxis:{
                        categories:[{% for stat in machine.get_latest_stats %}
                            '{{ stat.datetime|date:"H:i" }}',
                        {% endfor %}],
                        tickmarkPlacement:'on',
                        title:{
                            enabled:false
                        }
                    },
                    tooltip:{
                        formatter:function () {
                            return '' +
                                    this.x + ': ' + Highcharts.numberFormat(this.y, 0, ',') + ' millions';
                        }
                    },
                    yAxis:{
                        max:'100'
                    },

                    plotOptions:{
                        area:{
                            stacking:'normal',

                            lineColor:'#666666',
                            lineWidth:1,
                            marker:{
                                lineWidth:1,
                                lineColor:'#666666'
                            }
                        }
                    },
                    series:[
                        {
                            name:'User',
                            data:[{% for stat in machine.get_latest_stats %}
                                {{ stat.cpu_user }},
                            {% endfor %}
                            ]
                        },
                        {
                            name:'System',
                            data:[{% for stat in machine.get_latest_stats %}
                                {{ stat.cpu_system }},
                            {% endfor %}
                            ]
                        }
                    ]
                });
            });

        </script>


        <script type="text/javascript">

            var chart;
            $(document).ready(function () {
                chart = new Highcharts.Chart({
                    chart:{
                        renderTo:'container',
                        defaultSeriesType:'area'
                    },
                    title:{
                        text:'Minnebruk'
                    },

                    xAxis:{
                        categories:[{% for stat in machine.get_latest_stats %}
                            '{{ stat.datetime|date:"H:i" }}',
                        {% endfor %}],
                        tickmarkPlacement:'on',
                        title:{
                            enabled:false
                        }
                    },
                    yAxis:{
                        title:{
                            text:'Percent'
                        }
                    },

                    plotOptions:{
                        area:{
                            stacking:'percent',
                            lineColor:'#ffffff',
                            lineWidth:1,
                            marker:{
                                lineWidth:1,
                                lineColor:'#ffffff'
                            }
                        }
                    },
                    series:[
                        {
                            name:'Free',
                            data:[{% for stat in machine.get_latest_stats %}
                                {{ stat.mem_free }},
                            {% endfor %}]
                        },
                        {
                            name:'Used',
                            data:[{% for stat in machine.get_latest_stats %}
                                {{ stat.mem_used }},
                            {% endfor %}
                            ]
                        }
                    ]
                });


            });

        </script>

        <div id="container_load" style="width: 500px; height: 280px; margin: 0 auto"></div>


    </div>
    </div>

    <div class="row">
        <div class="span6">
            <div id="container_cpu" style="width: 500px; height: 300px; margin: 0 auto"></div>


        </div>
        <div class="span6">

            <div id="container" style="width: 500px; height: 300px; margin: 0 auto"></div>

        </div>

    </div>
    <div class="row">
        <div class="span6">
            <h2>{% trans "Schedules" %}</h2>

            <a href="{% url app.schedule.views.new machine.id %}">{% trans "New schedule" %}</a>

            <table class="table table-bordered table-striped">
                <thead>
                <tr>
                    <th>{% trans "Name" %}</th>
                    <th>{% trans "Last run time" %}</th>
                    <th>{% trans "Next run time" %}</th>
                </tr>
                </thead>
                <tbody>
                {% for schedule in machine.schedules.all %}
                    <tr>
                        <td>
                            <a href="{% url app.schedule.views.edit machine.id, schedule.id %}">{{ schedule.name }} </a>
                        </td>
                        <td>  {{ schedule.last_run_time|date:"d.m.Y H:i" }}
                            {% if not schedule.last_run_time %} {% trans "Not runned yet" %}{% endif %}</td>

                        <td>  {{ schedule.get_next_backup_time|date:"d.m.Y H:i" }}
                            {% if not schedule.get_next_backup_time %} {% trans "Not scheduled" %}{% endif %}</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
        <div class="span6">
            <h2>{% trans "Backups" %}</h2>
            <br>
            <table class="table table-bordered table-striped">
                <thead>
                <tr>
                    <th>{% trans "Date start" %}</th>
                    <th>{% trans "Date stop" %}</th>
                    <th>{% trans "Schedule" %}</th>
                </tr>
                </thead>
                <tbody>
                {% for backup in machine.get_latest_backups %}
                    <tr>
                        <td>{{ backup.time_started|date:"d.m.Y H:i" }}</td>
                        <td>{{ backup.time_ended|date:"d.m.Y H:i" }}</td>
                        <td>{{ backup.schedule.name }}</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    <div class="row">
        <div class="span12">
            <h2>{% trans "Log" %}</h2>
            <table class="table table-bordered table-striped">
                <thead>
                <tr>
                    <th>{% trans "Date" %}</th>
                    <th>{% trans "Description" %}</th>
                </tr>
                </thead>
                <tbody>
                {% for log in machine.get_latest_logs %}
                    <tr>
                        <td>{{ log.datetime|date:"d.m.Y H:i" }}</td>
                        <td>{{ log.text }}</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    </section>
{% endblock %}