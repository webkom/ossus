{% extends "base.html" %}

{% block content %}
        
    <script>


        $(function() {

            function createTable(value) {
                return "<table class='data'>" + value + "</table>"
            }

            function createThead(value) {
                return "<thead>" + value + "</thead>"
            }

            function createTbody(value) {
                return "<tbody>" + value + "</tbody>"
            }

            function createTr(value) {
                return "<tr>" + value + "</tr>"
            }

            function createLine(value, line) {
                return "<" + line + " style='width:110px;'>" + value + "</" + line + ">"
            }

            function createLines(values, line) {
                var string = "";

                for (index in values) {
                    string += createLine(values[index], line)
                }
                return string
            }

            function build_machine_tables(val) {
                var thead = createThead(createTr(createLines([val['name'],"Machine ID","Name", "IP", "Status"], "th")));
                var tbody_content = ""

                $.each(val['machines'], function(key_machine, val_machine) {

                    var status_message = "<img src='/static/images/ok.gif'>"
                    if (val_machine['running_backup']) {
                        status_message = "<img src='/static/images/spinner.gif'> performing backup"
                    }

                    tbody_content += createTr(createLines(["", val_machine['machine_id'], "<a href='/dashboard/" + val_machine['machine_id'] + "/view/'>"+val_machine['name']+"</a>", "10.0.1.1", status_message], "td"))

                });

                tbody = createTbody(tbody_content)

                return createTable(thead + tbody)

            }

            $.getJSON('/api/companies/', function(data) {
                var items = [];

                $.each(data, function(key, val) {
                    $("#tables_overview").append("<h1>" + val['name'] + "</h1>");
                    $.each(val['customers'], function(key, val) {
                        //Print customer name
                        $("#tables_overview").append("<h3>" + val['name'] + "</h3>");
                        $.each(val['locations'], function(key, val) {
                            $("#tables_overview").append(build_machine_tables(val));
                        });
                        //Add some space after table
                        $("#tables_overview").append("<br><br><br>");
                    });
                });
            });
        })

    </script>





    <div class="x12">

        <div id="tables_overview">

        </div>

    </div>



{% endblock %}